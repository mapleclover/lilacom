# 행사 안전 관리 AI 솔루션 개발 업무 가이드

## 문서 정보
- **버전**: 1.0.0
- **작성일**: 2025-11-19
- **문서 목적**: 행사 안전 관리 AI 솔루션 개발을 위한 업무 중심 가이드
- **대상 독자**: 개발팀, 프로젝트 매니저, 기술 리드

---

## 목차
1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택 결정](#2-기술-스택-결정)
3. [데이터 형식 정의](#3-데이터-형식-정의)
4. [AI 모델 선정 및 준비](#4-ai-모델-선정-및-준비)
5. [안전 규정 및 제약 조건](#5-안전-규정-및-제약-조건)
6. [4주 개발 로드맵](#6-4주-개발-로드맵)
7. [핵심 기능별 개발 태스크](#7-핵심-기능별-개발-태스크)
8. [테스트 및 검증 계획](#8-테스트-및-검증-계획)
9. [배포 준비 체크리스트](#9-배포-준비-체크리스트)
10. [문제 해결 가이드](#10-문제-해결-가이드)

---

## 1. 프로젝트 개요

### 1.1 프로젝트 목적

**비즈니스 목표:**
- 행사 기획 단계에서 AI 기반 안전 검토 자동화
- 법규 준수 자동 검증으로 법적 리스크 감소
- 전문가 컨설팅 비용 60% 절감
- 안전 사고 예방을 통한 사회적 가치 창출

**기술적 목표:**
- 배치도 이미지 → 구조화 데이터 변환 (정확도 90%+)
- 제약 조건 기반 최적화 (5분 이내)
- 법규 자동 검색 및 요약 (정확도 95%+)
- 사용자 친화적 프로토타입 (10분 내 학습 가능)

### 1.2 핵심 기능

1. **배치도 자동 분석**
   - 이미지 업로드 → AI 객체 인식
   - 부스, 무대, 출구 등 자동 탐지
   - JSON 형식으로 데이터 구조화

2. **레이아웃 최적화**
   - 방문자 수 기반 최적 배치 계산
   - 안전 거리, 동선, 대피 경로 고려
   - 새로운 배치도 자동 생성

3. **법규 자동 검색**
   - RAG 시스템으로 관련 법규 검색
   - 배치 요소별 준수 사항 매칭
   - LLM 기반 법규 요약

4. **안전 관리 리포트**
   - 인원 밀집도 분석 및 경고
   - 필요 안전 장비 및 위치 제안
   - 우선순위별 안전 체크리스트

### 1.3 프로젝트 범위

**포함 (Scope In):**
- ✅ 실내/실외 행사 배치도 분석
- ✅ 한국 법규 기준 안전 검증
- ✅ 2D 평면도 기반 최적화
- ✅ 웹 기반 프로토타입

**제외 (Scope Out):**
- ❌ 실시간 CCTV 모니터링
- ❌ 3D 시뮬레이션
- ❌ 다국어 지원 (1차는 한국어만)
- ❌ 모바일 앱
- ❌ 행사 중 실시간 관리

### 1.4 성공 지표

| 지표 | 목표 | 측정 방법 |
|------|------|-----------|
| 배치도 인식 정확도 | 90% | 테스트 셋 100장 |
| 전체 처리 시간 | 2분 이내 | 평균 응답 시간 |
| 법규 검색 정확도 | 95% | 전문가 평가 |
| 사용자 학습 시간 | 10분 이내 | 사용성 테스트 |
| 시스템 가용성 | 99% | 모니터링 |

---

## 2. 기술 스택 결정

### 2.1 언어 및 프레임워크

**선택된 기술 스택:**

| 구분 | 기술 | 버전 | 선정 이유 |
|------|------|------|-----------|
| 언어 | Python | 3.10+ | AI/ML 생태계, 빠른 개발 |
| 백엔드 | FastAPI | 0.104+ | 빠른 성능, 자동 문서화 |
| 프론트엔드 | Streamlit | 1.28+ | 빠른 프로토타입, Python 통합 |
| 객체 인식 | YOLOv8 | 8.0+ | 경량, 빠른 추론 |
| OCR | EasyOCR | 1.7+ | 한글 지원, 정확도 |
| 최적화 | OR-Tools | 9.8+ | Google 제공, 무료 |
| LLM | Llama 3.2 | 3B | 로컬 실행 가능, 무료 |
| LLM 런타임 | Ollama | 0.1+ | 간편한 모델 관리 |
| 벡터 DB | ChromaDB | 0.4+ | 로컬 실행, 무료 |
| 임베딩 | HuggingFace | - | 한국어 모델 지원 |

### 2.2 시스템 요구사항

**최소 사양 (개발):**
- CPU: Intel i5 (4코어)
- RAM: 16GB
- Storage: SSD 50GB
- GPU: 선택사항

**권장 사양 (프로덕션):**
- CPU: Intel i7/Xeon (8코어)
- RAM: 32GB
- Storage: SSD 100GB
- GPU: NVIDIA GTX 1660 (6GB VRAM)

**운영체제:**
- Ubuntu 22.04 LTS (추천)
- macOS 12+
- Windows 10/11 (WSL2)

### 2.3 의존성 관리

**주요 패키지 목록:**
- fastapi, uvicorn (백엔드)
- streamlit (프론트엔드)
- ultralytics (YOLOv8)
- easyocr (OCR)
- ortools (최적화)
- ollama, langchain (LLM)
- chromadb (벡터 DB)
- sentence-transformers (임베딩)
- matplotlib, plotly (시각화)
- pydantic (데이터 검증)
- pytest (테스트)

---

## 3. 데이터 형식 정의

### 3.1 입력 데이터 구조

**3.1.1 행사 기본 정보 (EventInfo)**

필수 필드:
- event_id: 행사 고유 ID
- name: 행사명
- type: 행사 유형 (exhibition, concert, conference, festival)
- venue: 장소 정보 (이름, 주소, 실내/실외)
- schedule: 일정 (날짜, 시작/종료 시간, 총 시간)
- capacity: 수용 정보 (면적, 예상 방문자, 피크 시간 방문자, 스태프 수)

**3.1.2 레이아웃 데이터 (Layout)**

필수 요소:
- boundaries: 행사장 경계 (좌표 배열)
- booths: 부스 목록 (ID, 이름, 위치, 크기, 예상 방문자)
- stages: 무대 목록 (ID, 위치, 크기, 수용 인원)
- exits: 출구 목록 (ID, 위치, 폭, 용량)
- entrances: 입구 목록
- safety_facilities: 안전 시설 (소화기, CCTV 등)
- obstacles: 장애물 (기둥, 고정 구조물 등)

### 3.2 출력 데이터 구조

**3.2.1 최적화 결과 (OptimizedLayout)**

포함 정보:
- optimization_id: 최적화 ID
- algorithm: 사용된 알고리즘 정보
- changes: 변경 사항 요약 (이동/크기 조정된 부스 수)
- optimized_elements: 최적화된 배치 (부스, 동선, 안전 구역)
- metrics: 최적화 전후 비교 (밀집도, 대피 시간, 병목 수)

**3.2.2 안전 분석 리포트 (SafetyReport)**

포함 정보:
- report_id: 리포트 ID
- status: 종합 상태 (pass, warning, critical)
- overall_score: 종합 점수 (0-100)
- density_analysis: 밀집도 분석 (전체, 구역별)
- pathway_analysis: 동선 분석 (폭, 병목 구간)
- evacuation_analysis: 대피 분석 (시간, 경로, 위험 구역)
- equipment_recommendations: 필요 장비 목록
- regulation_compliance: 법규 준수 현황
- safety_warnings: 우선순위별 경고
- checklist: 단계별 체크리스트

### 3.3 데이터 검증 규칙

**입력 검증:**
- 이미지: 10MB 이하, PNG/JPG/PDF
- 면적: 10㎡ ~ 100,000㎡
- 인원: 10명 ~ 100,000명
- 좌표: 음수 불가, 경계 내부

**출력 검증:**
- 모든 부스가 경계 내부
- 부스 간 최소 거리 유지
- 동선 폭 최소값 준수
- JSON 스키마 준수

---

## 4. AI 모델 선정 및 준비

### 4.1 YOLOv8 (객체 탐지)

**모델 정보:**
- 모델명: YOLOv8n (nano)
- 크기: 6.2MB
- 파라미터: 3.2M
- 추론 속도: ~30ms (CPU), ~5ms (GPU)
- 입력 크기: 640x640

**준비 작업:**
1. ✅ Ultralytics 라이브러리 설치
2. ✅ 사전 학습 모델 다운로드
3. ✅ 테스트 이미지로 추론 검증
4. 🔄 커스텀 학습 데이터셋 준비 (선택)
5. 🔄 Fine-tuning (선택)

**학습 데이터 수집 계획 (향후):**
- 목표: 행사 배치도 100장 이상
- 라벨링 클래스: booth, stage, exit, entrance, restroom, food_area, seating, pathway
- 도구: LabelImg, Roboflow
- 목표 정확도: mAP50 > 90%

### 4.2 EasyOCR (텍스트 인식)

**모델 정보:**
- 지원 언어: 한국어, 영어
- GPU 가속 지원
- 평균 정확도: 85-90%

**준비 작업:**
1. ✅ EasyOCR 설치
2. ✅ 한국어 모델 다운로드
3. ✅ 샘플 이미지 테스트
4. ✅ 전처리 파이프라인 구성

### 4.3 OR-Tools (최적화)

**라이브러리 정보:**
- 제공: Google
- 솔버: CP-SAT (Constraint Programming)
- 라이선스: Apache 2.0 (무료)

**준비 작업:**
1. ✅ OR-Tools 설치
2. ✅ 간단한 최적화 예제 실행
3. ✅ 제약 조건 정의
4. ✅ 목적 함수 설계
5. ✅ 성능 테스트

**제약 조건 목록:**
- 부스 비중첩
- 최소 거리 유지 (1.5m)
- 동선 폭 확보 (주 3m, 보조 1.5m)
- 대피 거리 제한 (100m)
- 출구 용량 충족

### 4.4 Llama 3.2 (LLM)

**모델 정보:**
- 파라미터: 3B (30억)
- 컨텍스트 길이: 8192 토큰
- 메모리: ~6GB RAM
- 언어: Multilingual (한국어 포함)
- 추론 속도: ~20 tokens/sec (CPU)

**준비 작업:**
1. ✅ Ollama 설치
2. ✅ Llama 3.2 3B 다운로드
3. ✅ 서버 실행 테스트
4. ✅ 프롬프트 템플릿 작성
5. ✅ JSON 출력 검증

**프롬프트 엔지니어링:**
- 법규 요약 프롬프트 작성
- 안전 체크리스트 생성 프롬프트 작성
- JSON 출력 형식 명시
- Few-shot 예시 추가
- 반복 테스트 및 개선

### 4.5 RAG 시스템 (법규 검색)

**구성 요소:**
- 벡터 DB: ChromaDB
- 임베딩: jhgan/ko-sroberta-multitask
- 문서 로더: PyPDFLoader
- 텍스트 분할: RecursiveCharacterTextSplitter

**준비 작업:**
1. ✅ ChromaDB 설치 및 초기화
2. 📄 법규 문서 수집 (PDF)
3. ✅ 문서 전처리 및 청크 분할
4. ✅ 임베딩 생성 및 저장
5. ✅ 검색 쿼리 테스트

**법규 문서 수집 목록:**
- 소방시설 설치 및 관리에 관한 법률
- 다중이용업소의 안전관리에 관한 특별법
- 공연법 시행령
- 집회 및 시위에 관한 법률
- 건축법 (피난 규정)

---

## 5. 안전 규정 및 제약 조건

### 5.1 한국 법규 기준

**5.1.1 소방시설법**

제9조 - 피난통로 기준:
- 주 피난통로: 최소 3m 폭
- 보조 피난통로: 최소 1.5m 폭
- 최대 대피 거리: 100m
- 출구 폭: 100명당 0.6m

제10조 - 소방시설:
- 소화기: 보행 거리 20m 이내
- 비상등: 20m 간격
- 유도등: 각 출구
- 경보설비: 100명 이상 시 필수

**5.1.2 다중이용업소법**

제13조 - 안전시설:
- CCTV 설치 (주요 출입구 및 내부)
- 비상조명 (30분 이상 작동)
- 구급함 비치

제9조 - 면적 기준:
- 100㎡ 이상: 자동화재탐지설비
- 100명 이상: 자동화재속보설비

**5.1.3 공연법 시행령**

제13조 - 공연장 기준:
- 무대-객석 안전거리 확보
- 무대 하중: 평당 500kg 이상
- 무대 출입구: 최소 2개소

### 5.2 밀집도 기준

**안전 밀집도 (명/㎡):**
- 0.5 이하: 안전
- 0.5-1.0: 쾌적
- 1.0-2.0: 수용 가능
- 2.0-3.0: 혼잡
- 3.0 이상: 위험

**조치 기준:**
- 안전/쾌적: 정상 운영
- 수용 가능: 주의 관찰
- 혼잡: 입장 제한 권고
- 위험: 즉시 입장 중단

### 5.3 우선순위 규칙

**Critical (즉시 조치):**
- 대피 거리 초과 (100m+)
- 출구 폭 부족
- 비상구 미확보

**High (행사 전 조치):**
- 주 동선 폭 부족 (3m 미만)
- 위험 수준 밀집도 (3.0+)
- 소화기 부족

**Medium (개선 권장):**
- 보조 동선 폭 부족 (1.5m 미만)
- 혼잡 수준 밀집도 (2.0-3.0)
- CCTV 부족

**Low (참고사항):**
- 좌석 간격
- 수용 가능 밀집도 (1.0-2.0)

---

## 6. 4주 개발 로드맵

### Week 1: 기본 인프라 구축

**목표:** 프로젝트 초기화 및 기본 UI/API 구조 완성

**Day 1-2: 프로젝트 초기화**
- [ ] Git 저장소 생성 및 초기 커밋
- [ ] Python 가상환경 설정
- [ ] requirements.txt 작성 및 패키지 설치
- [ ] 프로젝트 디렉토리 구조 생성
- [ ] .gitignore, README.md 작성

**Day 3-4: Streamlit UI 기본 틀**
- [ ] 메인 페이지 레이아웃 설계
- [ ] 이미지 업로드 기능 구현
- [ ] 파라미터 입력 폼 작성
- [ ] 간단한 이미지 표시 기능
- [ ] UI 컴포넌트 테스트

**Day 5-6: FastAPI 기본 구조**
- [ ] FastAPI 앱 초기화
- [ ] CORS 설정
- [ ] 기본 엔드포인트 구현 (/, /health)
- [ ] 파일 업로드 엔드포인트
- [ ] Pydantic 모델 정의
- [ ] API 문서 확인 (/docs)

**Day 7: Week 1 통합 및 회고**
- [ ] Streamlit ↔ FastAPI 연결 테스트
- [ ] 간단한 데이터 흐름 검증
- [ ] 에러 핸들링 추가
- [ ] 코드 리뷰
- [ ] Week 2 계획 수립

**산출물:**
- ✅ 프로젝트 저장소
- ✅ 기본 Streamlit UI
- ✅ 기본 FastAPI 서버
- ✅ 파일 업로드 기능

---

### Week 2: 레이아웃 최적화 엔진

**목표:** 이미지 처리 및 최적화 알고리즘 구현

**Day 8-9: 이미지 처리 모듈**
- [ ] YOLOv8 모델 로드 및 테스트
- [ ] 객체 인식 파이프라인 구현
- [ ] EasyOCR 통합
- [ ] 이미지 전처리 함수 작성
- [ ] JSON 변환 로직 구현
- [ ] 샘플 이미지로 테스트

**Day 10-11: OR-Tools 최적화 엔진**
- [ ] 제약 조건 함수 작성
  - 부스 비중첩 제약
  - 최소 거리 제약
  - 동선 폭 제약
  - 대피 거리 제약
- [ ] 목적 함수 정의 (밀집도 균등화)
- [ ] 솔버 실행 및 결과 파싱
- [ ] 최적화 결과 시각화 (Matplotlib)

**Day 12-13: 밀집도 및 대피 분석**
- [ ] 밀집도 계산 알고리즘 구현
- [ ] 히트맵 생성 기능
- [ ] 대피 시간 시뮬레이션
- [ ] 병목 구간 탐지 로직
- [ ] 분석 결과 구조화

**Day 14: Week 2 통합 및 테스트**
- [ ] 전체 최적화 파이프라인 연결
- [ ] API 엔드포인트 완성
- [ ] 통합 테스트
- [ ] 성능 측정 (처리 시간)
- [ ] 코드 리팩토링

**산출물:**
- ✅ 이미지 처리 모듈
- ✅ OR-Tools 최적화 엔진
- ✅ 밀집도 분석 기능
- ✅ 대피 시간 계산
- ✅ 최적화 API

---

### Week 3: LLM 및 RAG 통합

**목표:** 법규 검색 및 리포트 자동 생성

**Day 15-16: Ollama 및 LLM 설정**
- [ ] Ollama 서버 설치 및 실행
- [ ] Llama 3.2 3B 모델 다운로드
- [ ] LangChain 설정
- [ ] 기본 프롬프트 테스트
- [ ] JSON 출력 파싱 로직
- [ ] 프롬프트 템플릿 작성
  - 법규 요약용
  - 체크리스트 생성용

**Day 17-18: RAG 시스템 구축**
- [ ] 법규 문서 수집 (PDF 다운로드)
- [ ] ChromaDB 초기화
- [ ] 문서 전처리 파이프라인
  - PDF 파싱
  - 텍스트 청크 분할
  - 메타데이터 추가
- [ ] 임베딩 생성 및 저장
- [ ] 검색 기능 구현 및 테스트
- [ ] 검색 쿼리 최적화

**Day 19-20: 통합 리포트 생성**
- [ ] LLM + RAG 파이프라인 연결
- [ ] 컨텍스트 생성 로직
- [ ] 안전 리포트 생성 함수
- [ ] PDF 출력 기능 (ReportLab)
- [ ] JSON 출력 기능
- [ ] 리포트 포맷 디자인

**Day 21: Week 3 통합 및 테스트**
- [ ] 전체 LLM 파이프라인 테스트
- [ ] RAG 검색 정확도 검증
- [ ] 프롬프트 최적화
- [ ] 성능 측정
- [ ] 에러 핸들링 강화

**산출물:**
- ✅ Ollama + Llama 3.2 통합
- ✅ RAG 시스템
- ✅ 법규 벡터 DB
- ✅ 리포트 생성 기능
- ✅ PDF/JSON 출력

---

### Week 4: 통합, 테스트 및 완성

**목표:** 전체 시스템 통합 및 프로토타입 완성

**Day 22-23: 전체 파이프라인 통합**
- [ ] 모든 모듈 연결
- [ ] 통합 API 엔드포인트 작성
- [ ] 에러 핸들링 전체 점검
- [ ] 로깅 시스템 추가
- [ ] 데이터 흐름 검증
- [ ] 성능 최적화

**Day 24-25: UI 개선 및 시각화**
- [ ] Streamlit UI 고도화
  - 탭 구조 개선
  - 진행 상황 표시
  - 결과 시각화 (Plotly)
- [ ] 배치도 시각화 개선
- [ ] 다운로드 기능 추가
- [ ] 사용성 테스트
- [ ] UI/UX 개선

**Day 26-27: 테스트 및 버그 수정**
- [ ] 단위 테스트 작성
  - 이미지 처리 테스트
  - 최적화 테스트
  - LLM 테스트
- [ ] 통합 테스트
- [ ] 성능 테스트 (부하 테스트)
- [ ] 버그 리스트 작성
- [ ] 버그 수정
- [ ] 회귀 테스트

**Day 28: 문서화 및 배포 준비**
- [ ] README.md 완성
- [ ] API 문서 정리
- [ ] 사용자 가이드 작성
- [ ] 배포 스크립트 작성
- [ ] Docker 이미지 생성
- [ ] 환경 변수 설정
- [ ] 최종 검토

**산출물:**
- ✅ 전체 통합 시스템
- ✅ 개선된 UI
- ✅ 테스트 코드
- ✅ 문서화
- ✅ Docker 컨테이너
- ✅ **프로토타입 완성**

---

## 7. 핵심 기능별 개발 태스크

### 7.1 이미지 처리 모듈

**담당자:** 컴퓨터 비전 개발자

**작업 목록:**
1. 환경 설정
   - [ ] YOLOv8 설치 확인
   - [ ] EasyOCR 설치 및 모델 다운로드
   - [ ] OpenCV 설치

2. 전처리 파이프라인
   - [ ] 이미지 크기 조정 함수
   - [ ] 노이즈 제거 함수
   - [ ] 이진화 함수 (OCR용)
   - [ ] 회전 보정 함수

3. 객체 탐지
   - [ ] YOLO 모델 로더 작성
   - [ ] 추론 함수 구현
   - [ ] 바운딩 박스 파싱
   - [ ] 신뢰도 필터링

4. 텍스트 인식
   - [ ] OCR Reader 초기화
   - [ ] 텍스트 추출 함수
   - [ ] 후처리 (정제)

5. JSON 변환
   - [ ] 픽셀 → 실제 좌표 변환
   - [ ] 객체 분류 (부스/무대/출구)
   - [ ] JSON 스키마 생성

**예상 소요 시간:** 3-4일

**산출물:**
- ImageProcessor 클래스
- 테스트 코드
- 샘플 결과 JSON

---

### 7.2 레이아웃 최적화 모듈

**담당자:** 알고리즘 개발자

**작업 목록:**
1. 제약 조건 정의
   - [ ] 비중첩 제약 수식화
   - [ ] 최소 거리 제약 수식화
   - [ ] 동선 폭 제약 수식화
   - [ ] 대피 거리 제약 수식화
   - [ ] 경계 조건 제약

2. 목적 함수 설계
   - [ ] 밀집도 균등화 목표
   - [ ] 동선 길이 최소화 목표
   - [ ] 대피 시간 최소화 목표
   - [ ] 가중치 설정

3. OR-Tools 구현
   - [ ] CP-SAT 모델 생성
   - [ ] 변수 정의 (위치, 회전)
   - [ ] 제약 조건 추가
   - [ ] 솔버 실행
   - [ ] 결과 파싱

4. 최적화 검증
   - [ ] 제약 위반 확인
   - [ ] 개선도 측정
   - [ ] 성능 벤치마크

**예상 소요 시간:** 3-4일

**산출물:**
- LayoutOptimizer 클래스
- 제약 조건 함수 모음
- 최적화 결과 시각화

---

### 7.3 안전 분석 모듈

**담당자:** 데이터 분석 개발자

**작업 목록:**
1. 밀집도 분석
   - [ ] 그리드 기반 밀집도 계산
   - [ ] 구역별 밀집도 분석
   - [ ] 히트맵 생성
   - [ ] 위험 구역 식별

2. 대피 분석
   - [ ] 출구까지 최단 거리 계산
   - [ ] 대피 시간 시뮬레이션
   - [ ] 대피 경로 생성
   - [ ] 대피 불능 구역 탐지

3. 동선 분석
   - [ ] 주요 동선 식별
   - [ ] 유동 인구 추정
   - [ ] 병목 구간 탐지
   - [ ] 용량 대비 부하 계산

4. 규정 검증
   - [ ] 동선 폭 검증
   - [ ] 출구 용량 검증
   - [ ] 대피 거리 검증
   - [ ] 위반 사항 리스트 생성

**예상 소요 시간:** 2-3일

**산출물:**
- SafetyAnalyzer 클래스
- 밀집도 히트맵
- 대피 시뮬레이션 결과

---

### 7.4 RAG 시스템

**담당자:** NLP/ML 개발자

**작업 목록:**
1. 문서 수집
   - [ ] 법규 PDF 다운로드
   - [ ] 파일 정리 및 분류
   - [ ] 메타데이터 정의

2. 전처리
   - [ ] PDF 파싱 (PyPDF2)
   - [ ] 텍스트 추출
   - [ ] 청크 분할 (500자 단위)
   - [ ] 조항별 분리
   - [ ] 메타데이터 추가

3. 벡터 DB 구축
   - [ ] ChromaDB 초기화
   - [ ] 임베딩 모델 로드
   - [ ] 문서 임베딩 생성
   - [ ] DB 저장 및 인덱싱

4. 검색 기능
   - [ ] 유사도 검색 구현
   - [ ] 메타데이터 필터링
   - [ ] 검색 결과 정렬
   - [ ] 컨텍스트 생성

**예상 소요 시간:** 3-4일

**산출물:**
- RAGService 클래스
- 법규 벡터 DB (ChromaDB)
- 검색 테스트 결과

---

### 7.5 LLM 서비스

**담당자:** NLP 개발자

**작업 목록:**
1. Ollama 설정
   - [ ] Ollama 설치
   - [ ] Llama 3.2 다운로드
   - [ ] 서버 실행 확인
   - [ ] API 테스트

2. 프롬프트 엔지니어링
   - [ ] 법규 요약 프롬프트 작성
   - [ ] 체크리스트 생성 프롬프트 작성
   - [ ] JSON 스키마 명시
   - [ ] Few-shot 예시 추가
   - [ ] 반복 테스트 및 개선

3. LLM 통합
   - [ ] LangChain 설정
   - [ ] Ollama 연결
   - [ ] 프롬프트 템플릿 관리
   - [ ] 응답 파싱 로직
   - [ ] JSON 검증

4. 리포트 생성
   - [ ] 컨텍스트 통합
   - [ ] LLM 호출
   - [ ] 결과 구조화
   - [ ] PDF 생성 (ReportLab)
   - [ ] JSON 출력

**예상 소요 시간:** 3-4일

**산출물:**
- LLMService 클래스
- 프롬프트 템플릿 모음
- 리포트 생성 함수

---

### 7.6 API 및 UI

**담당자:** 풀스택 개발자

**작업 목록:**
1. FastAPI 백엔드
   - [ ] 엔드포인트 정의
   - [ ] 라우터 구성
   - [ ] Pydantic 모델 작성
   - [ ] 파일 업로드 처리
   - [ ] 에러 핸들링
   - [ ] 로깅 설정

2. Streamlit 프론트엔드
   - [ ] 페이지 레이아웃 설계
   - [ ] 파일 업로더 구현
   - [ ] 입력 폼 작성
   - [ ] 진행 상황 표시
   - [ ] 결과 시각화
   - [ ] 다운로드 기능

3. 통합
   - [ ] API 호출 로직
   - [ ] 상태 관리
   - [ ] 에러 처리
   - [ ] 사용자 피드백

**예상 소요 시간:** 4-5일

**산출물:**
- FastAPI 앱
- Streamlit 앱
- API 문서

---

## 8. 테스트 및 검증 계획

### 8.1 단위 테스트

**테스트 대상:**
- 이미지 처리 함수
- 최적화 알고리즘
- 안전 분석 함수
- RAG 검색 기능
- LLM 호출 및 파싱

**테스트 도구:**
- pytest
- unittest
- pytest-cov (커버리지)

**작업 목록:**
- [ ] 각 모듈별 테스트 케이스 작성
- [ ] Fixture 및 Mock 데이터 준비
- [ ] 테스트 실행 및 검증
- [ ] 커버리지 80% 이상 달성

### 8.2 통합 테스트

**테스트 시나리오:**
1. 전체 파이프라인 (이미지 → 리포트)
2. API 엔드포인트 순차 호출
3. 에러 상황 처리
4. 경계값 테스트

**작업 목록:**
- [ ] 통합 테스트 시나리오 작성
- [ ] 테스트 데이터 준비 (10개 샘플)
- [ ] 자동화 스크립트 작성
- [ ] CI/CD 파이프라인 구성

### 8.3 성능 테스트

**측정 지표:**
- 이미지 처리 시간
- 최적화 실행 시간
- LLM 응답 시간
- 전체 파이프라인 처리 시간
- 메모리 사용량
- CPU/GPU 사용률

**목표 값:**
- 이미지 분석: < 5초
- 최적화 (50 부스): < 60초
- LLM 생성: < 20초
- 전체: < 120초
- 메모리: < 8GB

**작업 목록:**
- [ ] 벤치마크 스크립트 작성
- [ ] 부하 테스트 (locust)
- [ ] 병목 구간 식별
- [ ] 최적화 적용

### 8.4 사용성 테스트

**테스트 대상:**
- UI 직관성
- 학습 시간
- 작업 완료 시간
- 오류 빈도

**작업 목록:**
- [ ] 테스트 참가자 모집 (5명)
- [ ] 태스크 시나리오 작성
- [ ] 테스트 실시 및 관찰
- [ ] 피드백 수집
- [ ] UI 개선 반영

### 8.5 품질 체크리스트

**기능 검증:**
- [ ] 배치도 이미지 업로드 및 표시
- [ ] 객체 인식 정확도 > 85%
- [ ] OCR 정확도 > 80%
- [ ] 최적화 성공률 > 90%
- [ ] 법규 검색 정확도 > 95%
- [ ] 리포트 자동 생성
- [ ] PDF/JSON 다운로드

**비기능 검증:**
- [ ] 처리 시간 < 2분
- [ ] 에러 핸들링 정상 작동
- [ ] 로그 정상 기록
- [ ] 메모리 누수 없음
- [ ] UI 반응 속도 < 1초

---

## 9. 배포 준비 체크리스트

### 9.1 코드 준비

- [ ] 모든 기능 구현 완료
- [ ] 테스트 통과 (단위, 통합)
- [ ] 코드 리뷰 완료
- [ ] 리팩토링 완료
- [ ] 주석 및 문서화
- [ ] 불필요한 코드 제거
- [ ] 하드코딩 값 환경 변수화

### 9.2 문서화

- [ ] README.md 작성
  - 프로젝트 소개
  - 설치 방법
  - 사용 방법
  - 라이선스
- [ ] API 문서 작성
- [ ] 사용자 가이드 작성
- [ ] 개발자 문서 작성
- [ ] CHANGELOG.md 작성

### 9.3 환경 설정

- [ ] requirements.txt 최종 확인
- [ ] .env.example 작성
- [ ] 환경 변수 문서화
- [ ] 설정 파일 정리 (config.py)

### 9.4 Docker 준비

- [ ] Dockerfile 작성
- [ ] docker-compose.yml 작성
- [ ] .dockerignore 작성
- [ ] 이미지 빌드 테스트
- [ ] 컨테이너 실행 테스트
- [ ] 볼륨 마운트 확인

### 9.5 보안 점검

- [ ] 민감 정보 환경 변수화
- [ ] .gitignore 확인
- [ ] API 키 관리 방안
- [ ] CORS 설정 확인
- [ ] 입력 검증 확인
- [ ] 에러 메시지에서 민감 정보 제거

### 9.6 배포 스크립트

- [ ] 로컬 실행 스크립트
- [ ] Docker 실행 스크립트
- [ ] 데이터베이스 초기화 스크립트
- [ ] 백업 스크립트

### 9.7 모니터링 준비

- [ ] 로깅 설정 확인
- [ ] 로그 레벨 설정
- [ ] 로그 파일 로테이션
- [ ] 에러 추적 도구 (선택)
- [ ] 성능 모니터링 (선택)

---

## 10. 문제 해결 가이드

### 10.1 자주 발생하는 문제

#### 문제 1: Ollama 연결 실패

**증상:**
```
Error: Failed to connect to Ollama at http://localhost:11434
```

**원인:**
- Ollama 서비스가 실행되지 않음
- 포트 충돌
- 모델 다운로드 미완료

**해결 방법:**
1. Ollama 서비스 상태 확인
2. 서비스 재시작: `ollama serve`
3. 포트 확인: `lsof -i :11434`
4. 모델 재다운로드: `ollama pull llama3.2:3b`

---

#### 문제 2: YOLO 모델 로드 실패

**증상:**
```
Error: Model 'yolov8n.pt' not found
```

**원인:**
- 모델 파일 미다운로드
- 경로 오류

**해결 방법:**
1. 모델 자동 다운로드 실행 (첫 실행 시)
2. 모델 파일 경로 확인
3. 수동 다운로드 후 지정 경로에 배치

---

#### 문제 3: ChromaDB 초기화 오류

**증상:**
```
Error: Cannot create collection
```

**원인:**
- 디렉토리 권한 문제
- 기존 DB 손상

**해결 방법:**
1. ChromaDB 디렉토리 삭제: `rm -rf chroma_db/`
2. 재생성 스크립트 실행: `python scripts/build_regulation_db.py`
3. 디렉토리 권한 확인: `chmod 755 chroma_db/`

---

#### 문제 4: 메모리 부족

**증상:**
```
Error: Out of memory
```

**원인:**
- LLM 모델이 메모리 차지
- 대용량 이미지 처리
- 메모리 누수

**해결 방법:**
1. 경량 모델 사용: `ollama pull llama3.2:1b`
2. 배치 크기 감소
3. 이미지 크기 조정
4. 스왑 메모리 증가
5. 메모리 프로파일링 (memory_profiler)

---

#### 문제 5: 최적화 시간 초과

**증상:**
```
Optimization timeout after 300 seconds
```

**원인:**
- 부스 개수가 너무 많음
- 제약 조건이 너무 복잡
- 초기 해가 없음

**해결 방법:**
1. 시간 제한 증가
2. 부스 개수 제한 (50개 이하)
3. 제약 조건 완화
4. 휴리스틱 초기해 제공

---

#### 문제 6: API 응답 시간 느림

**증상:**
```
Request timeout after 60 seconds
```

**원인:**
- LLM 추론 시간
- 이미지 처리 시간
- 네트워크 지연

**해결 방법:**
1. 비동기 처리 적용
2. 캐싱 도입
3. GPU 가속 사용
4. 타임아웃 시간 증가
5. 작업 큐 도입 (Celery)

---

### 10.2 디버깅 방법

**로그 확인:**
```bash
# 앱 로그
tail -f logs/app.log

# Docker 로그
docker-compose logs -f backend
docker-compose logs -f frontend

# 특정 에러 검색
grep "ERROR" logs/app.log
```

**환경 확인:**
```bash
# Python 패키지 버전
pip list

# 환경 변수
env | grep APP_

# 시스템 리소스
htop
nvidia-smi  # GPU 사용 시
```

**API 테스트:**
```bash
# 상태 확인
curl http://localhost:8000/

# 파일 업로드 테스트
curl -X POST http://localhost:8000/api/v1/upload \
  -F "file=@test.jpg"
```

### 10.3 성능 최적화

**이미지 처리 최적화:**
- 이미지 크기 제한 (최대 1920x1080)
- 전처리 파이프라인 최적화
- GPU 가속 사용

**최적화 엔진 최적화:**
- 초기해 제공
- 제약 조건 단순화
- 병렬 처리

**LLM 최적화:**
- 경량 모델 사용 (1B)
- 컨텍스트 길이 최소화
- 배치 처리
- 캐싱

**전체 시스템:**
- 비동기 처리 (asyncio)
- 작업 큐 (Celery + Redis)
- 데이터베이스 인덱싱
- CDN 사용 (프론트엔드)

---

## 11. 향후 확장 계획

### 11.1 단기 (3개월)

**1. 커스텀 YOLO 모델 학습**
- 작업: 행사 배치도 전용 데이터셋 구축
- 목표: 100장 이상 라벨링
- 도구: LabelImg, Roboflow
- 목표 정확도: mAP50 > 95%

**2. 다국어 지원**
- 작업: 영어, 중국어, 일본어 지원
- 법규 데이터베이스 다국어 확장
- UI 다국어 처리

**3. 사용자 피드백 시스템**
- 작업: 결과 평가 수집
- 피드백 DB 구축
- 모델 개선에 활용

### 11.2 중기 (6개월)

**1. 실시간 모니터링**
- 작업: CCTV 연동
- 실시간 인원 밀집도 분석
- 자동 알림 시스템

**2. 3D 시뮬레이션**
- 작업: Three.js 기반 3D 뷰어
- 가상 워크스루
- VR 지원 검토

**3. 모바일 앱**
- 작업: React Native 개발
- 현장 점검 기능
- 오프라인 모드

### 11.3 장기 (1년)

**1. AI 에이전트 시스템**
- 작업: 자율적인 배치 제안
- 시나리오 시뮬레이션
- 최적 행사 규모 추천

**2. 산업별 특화 모델**
- 음악 페스티벌
- 전시회
- 스포츠 이벤트
- 컨퍼런스

**3. SaaS 플랫폼**
- 구독 모델 도입
- API 제공
- 화이트라벨 솔루션

---

## 부록 A: 체크리스트 요약

### 프로젝트 시작 전
- [ ] 팀 구성 완료
- [ ] 역할 및 책임 분담
- [ ] 개발 환경 준비
- [ ] 법규 문서 수집
- [ ] 샘플 데이터 준비

### Week 1
- [ ] 프로젝트 저장소 생성
- [ ] 기본 UI 구현
- [ ] 기본 API 구현
- [ ] 파일 업로드 기능

### Week 2
- [ ] 이미지 처리 완료
- [ ] 최적화 엔진 완료
- [ ] 안전 분석 완료

### Week 3
- [ ] LLM 통합 완료
- [ ] RAG 시스템 완료
- [ ] 리포트 생성 완료

### Week 4
- [ ] 전체 통합 완료
- [ ] 테스트 완료
- [ ] 문서화 완료
- [ ] 배포 준비 완료

---

## 부록 B: 참고 자료

### 법규 자료
- 국가법령정보센터: https://www.law.go.kr
- 소방청: https://www.nfa.go.kr
- 문화체육관광부: https://www.mcst.go.kr

### 기술 문서
- YOLOv8: https://docs.ultralytics.com
- OR-Tools: https://developers.google.com/optimization
- LangChain: https://python.langchain.com
- Ollama: https://ollama.com/docs
- FastAPI: https://fastapi.tiangolo.com
- Streamlit: https://docs.streamlit.io

### 커뮤니티
- Ultralytics Discord
- LangChain Discord
- FastAPI Discord

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0.0 | 2025-11-19 | 초기 버전 작성 |

---

**문서 작성:** AI 개발팀  
**최종 검토:** 2025-11-19

**문서 끝**
